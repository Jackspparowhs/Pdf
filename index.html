<!doctype html>
<html lang="en" data-capable="pwa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5" />
<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>Animal List ‚Äî PirateRuler.com</title>
<link rel="icon" type="image/x-icon" href="https://pirateruler.com/favicon.ico">
<link rel="icon" sizes="512x512" href="https://pirateruler.com/favicon-512.png">
<link rel="apple-touch-icon" href="https://pirateruler.com/apple-touch-icon.png">

<meta name="description" content="Discover nature's wonders. Top rated animal database." />
<meta property="og:title" content="Animal List by PirateRuler.com" />
<meta property="og:description" content="Browse thousands of animal species, view details and high-res photos." />
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect width='400' height='400' fill='%23000000'/%3E%3Ctext x='50%25' y='50%25' font-family='Inter' font-weight='800' font-size='200' text-anchor='middle' dominant-baseline='middle' fill='white'%3EPR%3C/text%3E%3C/svg%3E" />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect rx='14' width='64' height='64' fill='%23000000'/%3E%3Ctext x='50%25' y='50%25' font-family='Inter,Arial,sans-serif' font-weight='800' font-size='26' text-anchor='middle' alignment-baseline='central' fill='white'%3EPR%3C/text%3E%3C/svg%3E">
<link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkFuaW1hbCBMaXN0IiwKICAic2hvcnRfbmFtZSI6ICJBbmltYWxzIiwKICAic3RhcnRfdXJsIjogIi9pbmRleC5odG1sIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjBmNGY4IiwKICAidGhlbWVfY29sb3IiOiAiIzAwMDAwMCIKfQo==">
<style>
  /* ----  your original colour scheme ---- */
  :root{
    --bg:#f0f4f8; --card:#ffffff; --muted:#64748b; --text:#0f172a;
    --border:#e2e8f0; --accent:#000000; --key-bg:#f1f5f9;
    --success:#10b981; --warning:#f59e0b; --error:#ef4444;
    --shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);
    --shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
    --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
    --radius-sm:4px; --radius-md:6px; --radius-lg:8px; --radius-xl:12px;
    --transition:all 0.2s cubic-bezier(0.4,0,0.2,1);
  }
  html.dark {
    --bg:#0f172a; --card:#1e293b; --muted:#94a3b8; --text:#f1f5f9;
    --border:#334155; --accent:#ffffff; --key-bg:#334155;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
  html{scroll-behavior:smooth;}
  body{background:var(--bg); font-family:'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--text); margin:0; transition:var(--transition);}
  .container{max-width:1400px;margin:0 auto;padding:20px;}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
  header.header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 24px; border-radius:var(--radius-xl); background:var(--card); box-shadow:var(--shadow-md); margin-bottom:20px; position:sticky; top:20px; z-index:100; border:1px solid var(--border);}
  .brand{display:flex; align-items:center; gap:12px;}
  .logo{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-weight:800; background:var(--accent); color:var(--bg); font-size:18px; flex-shrink:0; transition:var(--transition);}
  .logo:hover{transform:scale(1.05) rotate(5deg);}
  .brand-title .title-strong{font-size:24px;font-weight:800;margin:0; letter-spacing:-0.5px; color:var(--accent);}
  .brand-title .by{font-size:13px;color:var(--muted); margin-top:2px}
  .header-actions{display:flex; gap:12px; align-items:center;}
  .theme-toggle{width:52px;height:26px;border-radius:13px;background:var(--border);position:relative;cursor:pointer;transition:var(--transition);padding:2px;}
  .theme-toggle.active{background:var(--accent);}
  .theme-slider-thumb{width:22px;height:22px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:12px;position:absolute;left:2px;top:2px;transition:var(--transition);box-shadow:var(--shadow-sm);}
  .theme-toggle.active .theme-slider-thumb{transform:translateX(26px);}
  .btn{padding:10px 16px; border-radius:var(--radius-md); border:1px solid var(--border); cursor:pointer; font-weight:600; background:var(--bg); color:var(--text); transition:var(--transition); box-shadow:var(--shadow-sm); text-decoration:none;}
  .btn:hover{background:var(--accent); color:var(--bg); transform:translateY(-2px); box-shadow:var(--shadow-md);}
  .hamb{width:44px;height:44px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid var(--border);font-weight:bold;background:var(--bg);transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .hamb:hover{background:var(--accent);color:var(--bg);transform:translateY(-2deg) rotate(90deg);box-shadow:var(--shadow-md);}
  .hero{padding:48px 24px;border-radius:var(--radius-xl);background:var(--card);box-shadow:var(--shadow-lg);margin-bottom:24px;}
  @media(min-width:1100px){.hero{padding:56px 48px;}}
  .hero .big{font-size:40px;font-weight:800;margin:0;text-align:center;letter-spacing:-1px;}
  .hero .small{text-align:center;color:var(--muted);margin-top:12px;max-width:960px;margin-left:auto;margin-right:auto;line-height:1.6;}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-top:20px;align-items:start;}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius-xl);border:1px solid var(--border);padding:28px;animation:cardIn .42s both;box-shadow:var(--shadow-md);}
  .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
  @keyframes cardIn{from{transform:translateY(12px) scale(0.98);opacity:0}to{transform:none;opacity:1}}
  .card h2{margin:0 0 12px 0;font-size:22px;font-weight:800;letter-spacing:-0.5px;display:flex;align-items:center;gap:8px;}
  .hint{color:var(--muted);font-size:14px;margin-bottom:16px;line-height:1.5;}
  input[type="text"],input[type="number"],input[type="date"],input[type="color"],input[type="range"],select,textarea{width:100%;padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);font-size:15px;background:var(--bg);color:var(--text);transition:var(--transition);box-shadow:var(--shadow-sm);font-family:inherit;}
  input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,0.1);}
  .dark input:focus,.dark select:focus,.dark textarea:focus{box-shadow:0 0 0 3px rgba(96,165,250,0.2);}
  .row{display:flex;gap:12px;flex-wrap:wrap;}
  .row>*{flex:1;min-width:120px;}
  .primary{background:var(--accent);color:var(--bg);padding:10px 16px;border-radius:var(--radius-md);border:1px solid var(--accent);font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
  .primary:disabled{opacity:0.6;cursor:not-allowed;transform:none;}
  .ghost{background:var(--bg);color:var(--text);border:1px solid var(--border);padding:10px 14px;border-radius:var(--radius-md);cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .ghost:hover{background:var(--accent);color:var(--bg);transform:translateY(-2px);box-shadow:var(--shadow-md);}
  .result{margin-top:16px;font-weight:700;color:var(--text);border-top:1px solid var(--border);padding-top:14px;font-size:16px;min-height:24px;display:flex;align-items:center;gap:8px;}
  .result .icon{font-size:18px;}
  .result.success{color:var(--success);}
  .result.warning{color:var(--warning);}
  .result.error{color:var(--error);}
  aside{align-self:start;position:relative;}
  .feature-panel{background:var(--card);border-radius:var(--radius-xl);border:1px solid var(--border);padding:24px;box-shadow:var(--shadow-md);}
  @media(min-width:981px){.feature-panel{position:sticky;top:20px;max-height:calc(100vh - 40px);overflow:auto;}}
  .panel-title{font-weight:800;margin:6px 6px 14px 6px;font-size:20px;letter-spacing:-0.5px;display:flex;align-items:center;gap:8px;}
  .features{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  @media(max-width:700px){.features{grid-template-columns:1fr;}}
  .feature{display:flex;gap:14px;align-items:center;padding:18px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--card);min-height:110px;transition:var(--transition);}
  .feature:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
  .f-icon{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--bg);background:var(--accent);flex-shrink:0;font-size:18px;}
  .f-title{font-weight:700;margin-bottom:4px;}
  .f-desc{color:var(--muted);font-size:13px;line-height:1.5;}
  .useful-tips{margin-top:20px;padding:18px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg);}
  .useful-tips h3{margin:0 0 12px 0;font-weight:800;font-size:16px;display:flex;align-items:center;gap:8px;}
  .useful-tips ul{margin:0;padding-left:20px;}
  .useful-tips li{margin:8px 0;color:var(--muted);font-size:14px;line-height:1.5;}
  .useful-tips li strong{color:var(--text);}
  footer{margin-top:24px;padding:24px;border-radius:var(--radius-xl);background:var(--card);border:1px solid var(--border);text-align:center;box-shadow:var(--shadow-md);}
  .visit{padding:12px 24px;border-radius:var(--radius-md);display:inline-block;background:var(--accent);color:var(--bg);font-weight:800;text-decoration:none;transition:var(--transition);box-shadow:var(--shadow-sm);}
  .visit:hover{transform:translateY(-3px) scale(1.02);box-shadow:var(--shadow-lg);}
  .muted{color:var(--muted);font-size:14px;line-height:1.5;}
  .spacer{height:10px}
  .sidebar{position:fixed;top:0;right:0;height:100vh;width:380px;max-width:94vw;transform:translateX(120%);transition:transform .28s cubic-bezier(.2,.9,.3,1);z-index:1000;background:var(--card);border-left:1px solid var(--border);padding:24px;overflow:auto;box-shadow:var(--shadow-lg);}
  .sidebar.open{transform:translateX(0);}
  .close{display:flex;justify-content:flex-end;}
  .nav-list{margin-top:16px;display:flex;flex-direction:column;gap:8px}
  .nav-list a{display:block;padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg);color:var(--text);font-weight:600;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .nav-list a:hover{background:var(--accent);color:var(--bg);transform:translateX(-6px);box-shadow:var(--shadow-md);}
  .backup{margin-top:18px;color:var(--muted);font-size:13px;border-top:1px solid var(--border);padding-top:12px;line-height:1.5;}
  .toast{position:fixed;bottom:24px;right:24px;padding:16px 20px;border-radius:var(--radius-lg);background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow-lg);transform:translateY(120px);transition:transform .3s cubic-bezier(.2,.9,.3,1);z-index:1001;font-weight:600;display:flex;align-items:center;gap:10px;max-width:320px;}
  .toast.show{transform:translateY(0);}
  .toast .icon{font-size:20px;}
    
  /* ----  gallery & modal ---- */
  #gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:16px;}
    
  /* MOBILE GRID OVERRIDE: 2 Columns on small screens */
  @media(max-width:480px){
    .hero .big{font-size:28px;}
    .container{padding:12px;}
    .header{top:12px;padding:12px 16px;}
    .grid{gap:16px;}
    .card{padding:20px;}
      
    /* Forces 2 columns on mobile */
    #gallery { grid-template-columns: 1fr 1fr; } 
  }

  ::-webkit-scrollbar{width:8px;height:8px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}::-webkit-scrollbar-thumb:hover{background:var(--muted);}
  textarea{resize:vertical;min-height:100px;}
  .copy-btn{font-size:12px;padding:6px 10px;margin-left:8px;}
  .brand a{text-decoration:none;}
    
  .pic-card{background:var(--bg);border-radius:var(--radius-lg);overflow:hidden;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm);position:relative; aspect-ratio: 2/3;}
  .pic-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
    
  .pic-card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s ease;}
  
  /* Status badge */
  .score-badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; backdrop-filter: blur(4px); text-transform:uppercase;}
  .title-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px 10px 10px; color: white; font-size: 13px; font-weight: 600; text-align: center; }

  .loading-spinner{display:inline-block;width:20px;height:20px;border:3px solid var(--border);border-top:3px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin-left:8px;}
  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    
  .no-more{padding:20px;text-align:center;color:var(--muted); cursor:pointer; font-weight:600; border-radius:var(--radius-md); transition:var(--transition);}
  .no-more:hover{background:var(--key-bg);}
    
  #searchBox{width:100%;padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);font-size:15px;background:var(--bg);color:var(--text);transition:var(--transition);box-shadow:var(--shadow-sm);}
  #searchBox:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,0.1);}
  .dark #searchBox:focus{box-shadow:0 0 0 3px rgba(96,165,250,0.2);}
    
  /* ----  modal updated for Screenshot 1 Look ---- */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:2000;padding:20px;opacity:0;pointer-events:none;transition:opacity .25s ease;}
  .modal.show{opacity:1;pointer-events:auto;}
    
  /* FIX: Mobile Scrolling Logic Improved */
  .modal-content{
    width:100%; max-width:1000px; 
    background:var(--card); border-radius:var(--radius-xl);
    border:1px solid var(--border); box-shadow:var(--shadow-lg);
    display:flex; flex-direction:column; 
    /* Default (Mobile) */
    max-height: 90vh;
    overflow-y: auto; /* Allow entire modal to scroll on mobile */
    position: relative;
  }
    
  @media (min-width: 768px) {
    .modal-content { 
        flex-direction: row; 
        height: 600px; 
        overflow: hidden; /* Lock main container on desktop */
    }
    .modal-media-col { flex: 0.8; background: #000; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .modal-info-col { flex: 1.2; padding: 40px; display:flex; flex-direction:column; overflow-y:auto;}
  }

  /* Close Button (Top Right) */
  .close-modal-btn {
      position: absolute; top: 16px; right: 16px; 
      width: 32px; height: 32px; border-radius: 50%; 
      background: rgba(0,0,0,0.6); color: white; 
      display: flex; align-items: center; justify-content: center; 
      cursor: pointer; z-index: 10; font-weight: bold; font-size: 14px;
      backdrop-filter: blur(4px); transition: var(--transition);
      border: none;
  }
  .close-modal-btn:hover { background: var(--error); transform: scale(1.1); }
  
  @media (min-width: 768px) {
      .close-modal-btn { background: var(--key-bg); color: var(--text); }
  }
    
  .modal-media-col img {
    width: 100%; height: 100%; object-fit: contain; background:#000;
  }
    
  .modal-info-col { padding: 24px; position:relative;}
    
  .modal-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; line-height: 1.2; margin-top: 20px; text-transform:capitalize; }
  @media (min-width: 768px) { .modal-title { margin-top: 0; } }

  .modal-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; font-size: 13px; color: var(--muted); }
  .modal-tag { background: var(--key-bg); padding: 4px 8px; border-radius: 4px; font-weight: 600; color: var(--text); border:1px solid var(--border);}
  .modal-score { color: var(--success); font-weight: 800; display:flex; align-items:center; gap:4px; font-size: 14px;}
  
  .modal-desc { font-size: 15px; color: var(--text); line-height: 1.6; margin-bottom: 20px; white-space: pre-wrap; flex-grow: 1; }
  
  .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; font-size: 13px; border-top: 1px solid var(--border); padding-top: 16px; }
  .data-item strong { display: block; color: var(--text); margin-bottom: 2px; }
  .data-item span { color: var(--muted); }

  .modal-btn-row { display: flex; gap: 12px; align-items: center; margin-top: 24px; }
    
  /* ----  tabs ---- */
  .tabs{display:flex;gap:8px;margin-bottom:16px;justify-content:center;}
  .tab-btn{flex:0 0 auto; width:auto; min-width:80px; text-align:center;}
  .tab-btn.active{background:var(--accent);color:var(--bg);}
  /* ----  category chips ---- */
  .chips{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;justify-content:center;}
  .chip{
    cursor:pointer;padding:8px 16px;border-radius:20px;
    border:1px solid var(--border);background:var(--bg);
    font-size:14px;font-weight:600;transition:var(--transition);
  }
  .chip:hover{background:var(--accent);color:var(--bg);transform:translateY(-2px);}
  .chip.active{background:var(--accent);color:var(--bg);}
</style>
</head>
<body>
<div class="container">
  <a href="#main-content" class="sr-only">Skip to main content</a>
  <header class="header" role="banner">
    <div class="brand">
      <a href="index.html" aria-label="Home" style="display:flex;align-items:center;gap:12px">
        <div class="logo" aria-hidden="true">PR</div>
        <div class="brand-title">
          <div class="title-strong">Animal List</div>
          <div class="by">by PirateRuler.com</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <div class="theme-toggle" id="themeBtn" title="Toggle dark mode" aria-label="Toggle dark mode">
        <div class="theme-slider-thumb">üåô</div>
      </div>
      <div class="hamb" id="hambBtn" title="Open menu" aria-haspopup="true" aria-controls="sidebar">‚ò∞</div>
    </div>
  </header>

  <section class="hero" aria-labelledby="heroTitle">
    <h1 id="heroTitle" class="big">Discover Nature</h1>
    <p class="small">Explore thousands of animal species. High-res photos, details, and facts from around the globe.</p>
  </section>

  <main id="main-content" class="grid">
    <div>
      <section id="gallery-sec" class="card">
        
        <input id="searchBox" type="text" placeholder="Search animals (e.g. Lion, Eagle)..." autocomplete="off" style="margin-bottom:20px;">
        
        <div class="tabs">
          <button class="btn primary tab-btn active" data-filter="wild">Wild</button>
          <button class="btn ghost tab-btn" data-filter="pets">Pets</button>
          <button class="btn ghost tab-btn" data-filter="marine">Marine</button>
        </div>

        <div class="chips" id="chips">
          <span class="chip" data-query="Mammal">Mammals</span>
          <span class="chip" data-query="Bird">Birds</span>
          <span class="chip" data-query="Reptile">Reptiles</span>
          <span class="chip" data-query="Fish">Fish</span>
          <span class="chip" data-query="Big Cat">Big Cats</span>
        </div>

        <div id="gallery" aria-live="polite"></div>
        
        <div id="loader" class="no-more" onclick="loadMore()">
            Load More <span class="loading-spinner" style="display:none;"></span>
        </div>
        
        <div id="endMsg" class="no-more" style="display:none;">üéâ You reached the end.</div>
      </section>
    </div>

    <aside>
      <div class="feature-panel">
        <div class="panel-title">Information</div>
        
        <div class="useful-tips" style="margin-top:0; border:none; background:transparent; padding:0;">
          <p class="muted" style="margin-top:0;"><strong>Description:</strong><br>Access a comprehensive database of the animal kingdom. View scientific info, habitats, and high-quality images.</p>
          <p class="muted"><strong>How to Use:</strong><br>Click on any photo to view detailed facts.</p>
        </div>

        <div class="spacer"></div>
        <div class="feature" style="min-height:unset;align-items:flex-start;padding:14px">
          <div class="f-icon">PR</div>
          <div>
            <div class="f-title">Animal List by PirateRuler.com</div>
            <div class="f-desc" style="margin-top:6px;display:flex;gap:10px;flex-wrap:wrap;">
              <a class="btn" href="https://pirateruler.com/post/about.html" target="_blank" rel="noopener">About</a>
              <a class="btn" href="https://pirateruler.com/post/privacy.html" target="_blank" rel="noopener">Privacy</a>
              <a class="btn" href="https://pirateruler.com/post/contact.html" target="_blank" rel="noopener">Contact</a>
              <a class="btn" href="https://pirateruler.com/post/terms.html" target="_blank" rel="noopener">Terms</a>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <footer>
    <a class="visit" href="https://pirateruler.com" target="_blank" rel="noopener">Visit PirateRuler.com</a>
    <div style="height:12px"></div>
    <small class="muted">¬© <span id="year"></span> Animal List by PirateRuler.com ‚Äî Backup & resources: pirateruler.com | <span id="pwa-status"></span></small>
  </footer>
</div>

<aside id="sidebar" class="sidebar" role="dialog">
  <div class="close"><button class="ghost" id="closeSidebar">Close ‚úï</button></div>
  <h3>PirateRuler Links</h3>
  <p class="muted">Quick links & backup resources</p>
  <nav class="nav-list">
    <a href="https://pirateruler.com/post/about.html" target="_blank" rel="noopener">About ‚Äî PirateRuler</a>
    <a href="https://pirateruler.com/post/privacy.html" target="_blank" rel="noopener">Privacy Policy</a>
    <a href="https://pirateruler.com/post/contact.html" target="_blank" rel="noopener">Contact</a>
    <a href="https://pirateruler.com/post/terms.html" target="_blank" rel="noopener">Terms & Service</a>
  </nav>
  <div class="backup">
    If this site is offline you can visit PirateRuler for backups & resources:<br><a href="https://pirateruler.com" target="_blank">pirateruler.com</a>
  </div>
</aside>

<div id="toast" class="toast" role="status"></div>

<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-content" id="modalContent">
    <button class="close-modal-btn" onclick="closeModal()">‚úï</button>
    <div class="modal-media-col" id="modalMedia">
      </div>
    <div class="modal-info-col">
        <div id="modalTextContent" style="flex:1;">
            </div>
        <div class="modal-btn-row">
             <button class="btn ghost" onclick="closeModal()" style="flex:1;">Close</button>
             <a id="wikiLink" href="#" target="_blank" class="btn primary" style="flex:1; text-align:center;">Read Full Wiki</a>
        </div>
    </div>
  </div>
</div>

<script>
  // Year & PWA Status
  document.getElementById('year').textContent = new Date().getFullYear();
  if('serviceWorker' in navigator) document.getElementById('pwa-status').textContent = 'PWA Ready';

  // Theme Toggle
  const themeToggle = document.getElementById('themeBtn');
  const themeThumb = themeToggle.querySelector('.theme-slider-thumb');
  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    themeToggle.classList.toggle('active', isDark);
    themeThumb.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    document.querySelector('meta[name="theme-color"]').setAttribute('content', isDark ? '#000000' : '#ffffff');
  }
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') { document.documentElement.classList.add('dark'); themeToggle.classList.add('active'); themeThumb.textContent = '‚òÄÔ∏è'; }
  themeToggle.addEventListener('click', toggleTheme);

  // Sidebar
  const sidebar = document.getElementById('sidebar');
  const hambBtn = document.getElementById('hambBtn');
  const closeSidebar = document.getElementById('closeSidebar');
  function openSidebar(){ sidebar.classList.add('open'); sidebar.setAttribute('aria-hidden','false'); closeSidebar.focus(); }
  function closeSB(){ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); }
  hambBtn.addEventListener('click', openSidebar);
  closeSidebar.addEventListener('click', closeSB);
  document.addEventListener('keydown', e => { if(e.key === 'Escape') closeSB(); });
  document.addEventListener('click', e => { if(sidebar.classList.contains('open') && !sidebar.contains(e.target) && !hambBtn.contains(e.target)) closeSB(); });

  // Toast
  function showToast(message, icon = '‚ÑπÔ∏è') {
    const toast = document.getElementById('toast');
    toast.innerHTML = `<span class="icon">${icon}</span><span style="margin-left:8px">${message}</span>`;
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.classList.remove('show'), 3500);
  }

  /* ----------  WikiFauna API (Wikipedia REST API)  ---------- */
  
  // Lists for "Feed" simulation (since Wiki API is search-based, we simulate a feed by listing cool animals)
  const lists = {
    wild: ['Lion', 'Tiger', 'Elephant', 'Giraffe', 'Cheetah', 'Zebra', 'Panda', 'Gorilla', 'Kangaroo', 'Koala', 'Rhino', 'Hippo', 'Leopard', 'Wolf', 'Bear', 'Fox', 'Eagle', 'Hawk', 'Falcon', 'Owl', 'Vulture', 'Deer', 'Moose', 'Elk', 'Bison', 'Jaguar'],
    pets: ['Dog', 'Cat', 'Hamster', 'Rabbit', 'Parrot', 'Goldfish', 'Guinea pig', 'Ferret', 'Turtle', 'Chameleon', 'Gecko', 'Budgerigar', 'Cockatiel', 'Poodle', 'Golden Retriever', 'Siamese cat', 'Persian cat'],
    marine: ['Shark', 'Whale', 'Dolphin', 'Octopus', 'Squid', 'Jellyfish', 'Seahorse', 'Starfish', 'Crab', 'Lobster', 'Seal', 'Walrus', 'Penguin', 'Sea turtle', 'Clownfish', 'Manta ray', 'Orca']
  };

  const searchBox       = document.getElementById('searchBox');
  const gallery         = document.getElementById('gallery');
  const loader          = document.getElementById('loader');
  const loaderSpinner = loader.querySelector('.loading-spinner');
  const endMsg          = document.getElementById('endMsg');
  const modal           = document.getElementById('modal');
  const modalMedia    = document.getElementById('modalMedia');
  const modalTextContent = document.getElementById('modalTextContent');
  const wikiLink        = document.getElementById('wikiLink');

  // State
  let currentList = lists.wild; // default list
  let currentIndex = 0;
  let loading = false;
  let isSearchMode = false;
  
  // Helper: Get Wiki Data
  async function fetchWikiData(title) {
     try {
         // Using Wikipedia REST API v1 (Summary) - High Quality, No Key Needed
         const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`);
         if(!res.ok) return null;
         return await res.json();
     } catch(e) { return null; }
  }

  // Store loaded items
  const itemsMap = new Map();

  function buildCard(data){
    if(!data || data.type === 'disambiguation') return '';
    // Use originalimage if available, else thumbnail
    const thumb = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
    
    if(!thumb) return ''; // Skip items without images for clean look

    const title = data.title;
    const desc = data.description || 'Species';
    
    itemsMap.set(data.title, data);

    return `
      <div class="pic-card" onclick='openModalForItem("${escapeAttr(data.title)}")'>
        <img src="${escapeAttr(thumb)}" loading="lazy" alt="${escapeAttr(title)}">
        <div class="score-badge">WikiFauna</div>
        <div class="title-overlay">${escapeAttr(title)}</div>
      </div>`;
  }

  function escapeAttr(s){ return String(s||'').replace(/'/g,"%27").replace(/"/g,'&quot;'); }

  // Main Load Function
  async function loadItems() {
    if(loading) return;
    setLoading(true);

    // If searching, we don't paginate the same way
    if(isSearchMode) {
        setLoading(false);
        return; 
    }

    // Load next batch from list
    const batchSize = 12;
    const batch = currentList.slice(currentIndex, currentIndex + batchSize);
    
    if(batch.length === 0) {
        endMsg.style.display = 'block';
        loader.style.display = 'none';
        setLoading(false);
        return;
    }

    const promises = batch.map(name => fetchWikiData(name));
    const results = await Promise.all(promises);

    let html = '';
    results.forEach(data => {
        if(data) html += buildCard(data);
    });

    gallery.insertAdjacentHTML('beforeend', html);
    currentIndex += batchSize;
    
    if(currentIndex >= currentList.length) {
        endMsg.style.display = 'block';
        loader.style.display = 'none';
    }
    
    setLoading(false);
  }

  // Search Function
  async function performSearch(query) {
      setLoading(true);
      gallery.innerHTML = '';
      endMsg.style.display = 'none';
      loader.style.display = 'none'; // hide loader during direct search
      
      // 1. Try direct hit first
      const direct = await fetchWikiData(query);
      let html = '';
      
      if(direct) {
          itemsMap.set(direct.title, direct);
          html += buildCard(direct);
      }
      
      // 2. Search API to find related
      try {
          const searchRes = await fetch(`https://en.wikipedia.org/w/api.php?origin=*&action=opensearch&search=${encodeURIComponent(query)}&limit=10&namespace=0&format=json`);
          const searchData = await searchRes.json();
          // searchData[1] contains titles
          const relatedTitles = searchData[1].filter(t => t !== (direct ? direct.title : ''));
          
          const promises = relatedTitles.map(t => fetchWikiData(t));
          const results = await Promise.all(promises);
          
          results.forEach(data => {
              if(data) html += buildCard(data);
          });
          
      } catch(e) { console.error(e); }

      if(html === '') {
          gallery.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted)">No animals found. Try "Tiger" or "Eagle".</div>';
      } else {
          gallery.innerHTML = html;
      }
      
      setLoading(false);
  }

  function setLoading(bool){
     loading = bool;
     if(bool) {
         loaderSpinner.style.display = 'inline-block';
         loader.style.cursor = 'wait';
     } else {
         loaderSpinner.style.display = 'none';
         loader.style.cursor = 'pointer';
     }
  }
  
  async function loadMore(){
      if(!isSearchMode) loadItems();
  }

  // Modal Logic
  function openModalForItem(title) {
      const data = itemsMap.get(title);
      if(!data) return;

      modalMedia.innerHTML = '';
      modalTextContent.innerHTML = '';
      
      // Image
      const imgUrl = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : '');
      if(imgUrl) {
          const img = document.createElement('img');
          img.src = imgUrl;
          modalMedia.appendChild(img);
      }

      // Text
      const displayTitle = data.title;
      const desc = data.description || 'No classification available';
      const extract = data.extract || 'No details available.';
      
      modalTextContent.innerHTML = `
        <div class="modal-title">${displayTitle}</div>
        <div class="modal-meta">
            <span class="modal-tag">${desc}</span>
            <span class="modal-score">Verfied</span>
        </div>
        <div class="modal-desc">${extract}</div>
      `;

      wikiLink.href = data.content_urls ? data.content_urls.desktop.page : '#';
      
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
  }

  function closeModal(){
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden','true');
  }
  modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

  // Event Listeners
  
  // Tabs
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.remove('primary', 'active'); b.classList.add('ghost');
      });
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      e.target.classList.remove('ghost'); e.target.classList.add('primary', 'active');
      
      // Switch List
      const filter = e.target.dataset.filter;
      currentList = lists[filter] || lists.wild;
      currentIndex = 0;
      isSearchMode = false;
      gallery.innerHTML = '';
      endMsg.style.display = 'none';
      loader.style.display = 'block';
      loadItems();
    });
  });

  // Chips (Act as quick search)
  document.querySelectorAll('.chip').forEach(chip => {
    chip.addEventListener('click', ()=> {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('primary', 'active'); b.classList.add('ghost'); });
        chip.classList.add('active');
        
        isSearchMode = true;
        searchBox.value = chip.dataset.query;
        performSearch(chip.dataset.query);
    });
  });

  // Search Box
  let searchTimeout;
  searchBox.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(()=>{
      const val = searchBox.value.trim();
      if(val.length > 2) {
          isSearchMode = true;
          performSearch(val);
      } else if (val.length === 0) {
          // Reset to home
          isSearchMode = false;
          document.querySelector('.tab-btn[data-filter="wild"]').click();
      }
    }, 600);
  });

  // Infinite Scroll
  const io = new IntersectionObserver((entries)=>{
    if (entries[0].isIntersecting && !loading && !isSearchMode) {
        loadMore();
    }
  }, { rootMargin: '400px' });
  io.observe(loader);

  // Init
  loadItems(); 
</script>
</body>
</html>
